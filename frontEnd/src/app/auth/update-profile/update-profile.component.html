<div class="container" *ngIf="submitting">
  <app-loading></app-loading>
</div>

<div class="container-fluid p-5 bg-dark" *ngIf="!submitting">
  
  <div class="container">
    
    <div class="modal-header">
      <h5 class="modal-title">Complete your Profile</h5>
    </div>
    
    <div class="modal-body dash-modal-body bg-white" style="border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;">
      <p>We just need a little bit more information so that you can get the most out of Onlylocalfood.com.</p>
      
      <!-- Form-->
      <form 
      (ngSubmit)="onSubmit(userForm)" 
      [formGroup]="userForm">
      
        <!-- User Form Group -->
        <div formGroupName="user">
          
          <div class="row form-section">
            
            <div class="col-12 form-section-header">
              <h5>General Details</h5>
            </div>
            
            <div class="col-12 form-section-body">
              
              <div class="row">
                <label for="firstName" class="col-xs-12 col-sm-4 col-form-label text-sm-right">First Name:</label>
                <div class="col-xs-12 col-sm-8 input-group">
                  <input class="form-input-custom" type="text" id="firstName" formControlName="firstName">
                  <small *ngIf="!userForm.get('user.firstName').valid && userForm.get('user.firstName').touched" class="help-block">Please enter your first name.</small>
                </div>
              </div>
              
              <!-- email -->
              
              <div class="row">
                <label for="name" class="col-xs-12 col-sm-4 col-form-label text-sm-right">Email:</label>
                <div class="col-xs-12 col-sm-8 input-group">
                  <input class="form-input-custom" type="email" id="email" formControlName="email">
                  <small *ngIf="!userForm.get('user.email').valid && userForm.get('user.email').touched" class="help-block">Please enter your email. We'll need this to send you details about your orders and notifications.</small>
                </div>
              </div>
              
            </div>
            
          </div>
          
          <div class="form-section row">
            
            <!-- consumer or producer -->
            <div class="col-12 form-section-body my-5">
              <h5 class="h5-responsive">
                <label for="role">Are you signing up as a Consumer, Producer, or Market?</label>
              </h5>
              <div class="pl-3">
                
                <label class="pr-3">
                  Consumer:
                  <input type="radio" value="consumer" formControlName="role" (change)="onSelectConsumer()" />
                </label>
                
                <label class="pr-3">
                  Producer:
                  <input type="radio" formControlName="role" value="producer" (change)=" onSelectProducer()" />
                </label>
                
                <label>
                  Market:
                  <input type="radio" formControlName="role" value="market" (change)="onSelectMarket()" />
                </label>
                
              </div>
            </div>
            
          </div>
          
        </div>
        
        <!-- Producer form -->
        <div class="row" *ngIf="role === 'producer'">
          
          <div class="col-12">
            <h2 class="h2-responsive">
              <strong>Great - welcome to Onlylocalfood.com!</strong>
            </h2>
            <p>We're always happy to have new producers.</p>
          </div>
          
          <app-add-new-producer [producerForm]="userForm.controls.producer"></app-add-new-producer>
        
        </div>

        <!-- Market Form -->
        <div class="row" *ngIf="role === 'market'">
          
          <div class="col-12">
            <h2 class="h2-responsive">
              <strong>Great - welcome to Onlylocalfood.com!</strong>
            </h2>
            <p>We're always happy to have new markets.</p>
          </div>

          <app-add-new-market [marketForm]="userForm.controls.market"></app-add-new-market>
        
        </div>
        
        <hr>
        
        <div class="text-center">
          
          <p class="small">By signing up, you'll be added to our newsletter (from which you can always unsubscribe), and you agree to our <a routerLink="/privacy">Privacy Policy</a>.
          </p>
          <p class="small">
            We only send emails to tell you what's going on with your orders, or to inform you of exciting changes!
          </p>
          
          <button 
            *ngIf="userForm.get('user.role').value === 'consumer'" 
            type="submit" 
            class="btn btn-olf-primary" 
            [disabled]="!userForm.valid">
            Complete Signup</button>
          
          <button 
            *ngIf="userForm.get('user.role').value === 'producer'" 
            type="submit" 
            class="btn btn-olf-primary" 
            [disabled]="!userForm.valid || !userForm.controls.producer.valid">
            Complete Signup</button>

          <button 
            *ngIf="userForm.get('user.role').value === 'market'" 
            type="submit" 
            class="btn btn-olf-primary" 
            [disabled]="!userForm.valid">
            Complete Signup</button>
          
        </div>
      </form> 
      <!-- Form-->
  
    </div>

  </div>
  
</div>